steps:
- script: |
    sudo update-alternatives --set php /usr/bin/php$(phpVersion)
    sudo update-alternatives --set phar /usr/bin/phar$(phpVersion)
    sudo update-alternatives --set phpdbg /usr/bin/phpdbg$(phpVersion)
    sudo update-alternatives --set php-cgi /usr/bin/php-cgi$(phpVersion)
    sudo update-alternatives --set phar.phar /usr/bin/phar.phar$(phpVersion)
    php -v
  displayName: Use PHP version $(phpVersion)

- script: |
    file=$(mktemp)
    expected_signature="$(wget -q -O - https://composer.github.io/installer.sig)"
    php -r "copy('https://getcomposer.org/installer', '$file');"
    actual_signature="$(php -r "echo hash_file('SHA384', '$file');")"

    [[ $expected_signature = $actual_signature ]] || {
        >&2 echo ERROR: Invalid installer signature
        exit 1
    }

    php "$file"
    sudo mv composer.phar /usr/local/bin/composer
    composer -V
  displayName: Install Composer

- script: composer validate
  displayName: Validate Composer file

- script: |
    composer global require hirak/prestissimo
    composer install -n --no-progress --no-suggest
  displayName: Install dependencies
